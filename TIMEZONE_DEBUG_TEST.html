<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timezone Debug Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        h2 { color: #666; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
        .info { 
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        .label { font-weight: bold; color: #555; }
        .value { color: #333; font-family: monospace; }
        .test-case {
            background: #f9f9f9;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 10px 0;
        }
        .error { color: #f44336; }
        .success { color: #4CAF50; }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #45a049; }
        #realTimeTest { font-size: 24px; font-weight: bold; color: #4CAF50; }
    </style>
</head>
<body>
    <h1>üåç Timezone Debug & Test Tool</h1>

    <div class="card">
        <h2>üìç Your System Information</h2>
        <div class="info">
            <div class="label">Current Time:</div>
            <div class="value" id="currentTime"></div>
        </div>
        <div class="info">
            <div class="label">Timezone:</div>
            <div class="value" id="timezone"></div>
        </div>
        <div class="info">
            <div class="label">UTC Offset:</div>
            <div class="value" id="utcOffset"></div>
        </div>
        <div class="info">
            <div class="label">Browser Locale:</div>
            <div class="value" id="locale"></div>
        </div>
    </div>

    <div class="card">
        <h2>üß™ Test Cases</h2>
        
        <div class="test-case">
            <h3>Test 1: Simulate Backend UTC Time (4 hours ago)</h3>
            <div class="info">
                <div class="label">Backend UTC Time:</div>
                <div class="value" id="test1_utc"></div>
            </div>
            <div class="info">
                <div class="label">Your Local Time:</div>
                <div class="value" id="test1_local"></div>
            </div>
            <div class="info">
                <div class="label">Relative Display:</div>
                <div class="value" id="test1_relative"></div>
            </div>
            <div class="info">
                <div class="label">Should Show:</div>
                <div class="value success">4 hours ago</div>
            </div>
        </div>

        <div class="test-case">
            <h3>Test 2: Just Now (30 seconds ago)</h3>
            <div class="info">
                <div class="label">Relative Display:</div>
                <div class="value" id="test2_relative"></div>
            </div>
        </div>

        <div class="test-case">
            <h3>Test 3: Custom Time Input</h3>
            <input type="datetime-local" id="customTime" />
            <button onclick="testCustomTime()">Test This Time</button>
            <div class="info">
                <div class="label">Result:</div>
                <div class="value" id="test3_result"></div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>‚è±Ô∏è Real-Time Relative Time Test</h2>
        <p>Watch this update every second:</p>
        <div id="realTimeTest"></div>
    </div>

    <div class="card">
        <h2>üîç Backend Data Simulation</h2>
        <p>Paste a UTC timestamp from backend:</p>
        <input type="text" id="backendTime" placeholder="2025-12-15T08:00:00.000Z" style="width: 100%; padding: 10px; margin: 10px 0;" />
        <button onclick="testBackendTime()">Test Backend Time</button>
        <div id="backendResult"></div>
    </div>

    <script>
        // Timezone utility functions (copied from your app)
        function formatActivityLogDate(dateString) {
            if (!dateString) return '-';
            
            try {
                const date = new Date(dateString);
                
                if (isNaN(date.getTime())) {
                    return '-';
                }

                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);

                console.log('Debug:', {
                    input: dateString,
                    parsed: date.toISOString(),
                    now: now.toISOString(),
                    diffMs,
                    diffMins,
                    diffHours
                });

                if (diffMins < 1) return 'Just now';
                if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
                if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
                if (diffDays < 7) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;

                return date.toLocaleString();
            } catch (error) {
                console.error('Error:', error);
                return '-';
            }
        }

        // Update system info
        function updateSystemInfo() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleString();
            document.getElementById('timezone').textContent = Intl.DateTimeFormat().resolvedOptions().timeZone;
            document.getElementById('utcOffset').textContent = `UTC ${-now.getTimezoneOffset() / 60 >= 0 ? '+' : ''}${-now.getTimezoneOffset() / 60}:00`;
            document.getElementById('locale').textContent = navigator.language;
        }

        // Test 1: 4 hours ago
        function runTest1() {
            const now = new Date();
            const fourHoursAgo = new Date(now.getTime() - (4 * 60 * 60 * 1000));
            
            document.getElementById('test1_utc').textContent = fourHoursAgo.toISOString();
            document.getElementById('test1_local').textContent = fourHoursAgo.toLocaleString();
            document.getElementById('test1_relative').textContent = formatActivityLogDate(fourHoursAgo.toISOString());
        }

        // Test 2: Just now
        function runTest2() {
            const now = new Date();
            const thirtySecondsAgo = new Date(now.getTime() - 30000);
            document.getElementById('test2_relative').textContent = formatActivityLogDate(thirtySecondsAgo.toISOString());
        }

        // Test 3: Custom time
        function testCustomTime() {
            const input = document.getElementById('customTime').value;
            if (!input) {
                alert('Please select a date and time');
                return;
            }
            const date = new Date(input);
            document.getElementById('test3_result').textContent = formatActivityLogDate(date.toISOString());
        }

        // Real-time test
        let testStartTime = new Date();
        function updateRealTime() {
            document.getElementById('realTimeTest').textContent = formatActivityLogDate(testStartTime.toISOString());
        }

        // Backend time test
        function testBackendTime() {
            const input = document.getElementById('backendTime').value;
            if (!input) {
                alert('Please enter a UTC timestamp');
                return;
            }

            const date = new Date(input);
            const now = new Date();
            const diffMs = now - date;
            const diffHours = Math.floor(diffMs / 3600000);

            const result = `
                <div class="info">
                    <div class="label">Backend UTC:</div>
                    <div class="value">${input}</div>
                </div>
                <div class="info">
                    <div class="label">Your Local Time:</div>
                    <div class="value">${date.toLocaleString()}</div>
                </div>
                <div class="info">
                    <div class="label">Actual Hours Ago:</div>
                    <div class="value">${diffHours} hours</div>
                </div>
                <div class="info">
                    <div class="label">Display Result:</div>
                    <div class="value success">${formatActivityLogDate(input)}</div>
                </div>
            `;
            document.getElementById('backendResult').innerHTML = result;
        }

        // Initialize
        updateSystemInfo();
        runTest1();
        runTest2();
        setInterval(updateSystemInfo, 1000);
        setInterval(updateRealTime, 1000);
    </script>
</body>
</html>
